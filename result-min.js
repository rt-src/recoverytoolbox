var secondTry=!1;convertPreviewTreeNodeToHtml=(e,t=!1)=>{let n=[`<li class="expanded ${t?"my-3":""}">`];return n.push(`<span>${e.folderName}</span>`),n.push("<ol>"),"0"!=e.folderItems&&n.push(`<li class="normal text-truncate" style="max-width: 171px;">${e.folderItems} items elements</li>`),e.children instanceof Array&&e.children.length>0&&e.children.forEach((e=>{let t=convertPreviewTreeNodeToHtml(e);n.push(t)})),n.push("</ol>"),n.push("</li>"),n.join("")},getResultInfo=e=>{debug;var t=new XMLHttpRequest;t.open("GET",`${API}/api/repair/files/${e}/result`,!0),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status&&t.response&&(resp=JSON.parse(t.response),debug,resp)){if(document.getElementById("src-filename").innerText=resp.SourceName,document.getElementById("res-size").innerText=resp.Size,document.getElementById("src-size").innerText=resp.SourceSize,document.getElementById("report").innerText=resp.ReportContent,document.getElementById("rt-next-button").addEventListener("click",(()=>{"undefined"!=typeof gtag&&gtag("event","click_next_button_to_payment_page"),window.location=`${nextBasePage}/payment.html?id=${e}`}),!1),resp.DemoCount>0&&(document.getElementById("btn-demo").removeAttribute("hidden"),document.getElementById("btn-demo").addEventListener("click",(()=>{"undefined"!=typeof gtag&&gtag("event","click_demo_download_button");var t=`${API}/repair/demo/${e}/1`;window.open(t,"_blank")}),!1)),resp.PrerviewCount>0)if(".mdb"!=resp.Type&&".accdb"!=resp.Type||""==resp.PreviewJson)if(".ost"==resp.Type&&""!=resp.PreviewJson){previewJson=JSON.parse(resp.PreviewJson),debug,(s=document.getElementById("btn-json-preview")).setAttribute("data-src","#dialog-content-tree"),s.removeAttribute("hidden");let e=[];e=previewJson instanceof Array&&previewJson.length>0?previewJson:[previewJson];let t="";e.forEach((e=>{t+=convertPreviewTreeNodeToHtml(e,!0)})),document.getElementById("root-tree").innerHTML=t,document.getElementById("btn-preview").addEventListener("click",(()=>{"undefined"!=typeof gtag&&gtag("event","click_preview_button"),document.getElementsByClassName("fancybox")[0].click()}),!1)}else{(s=document.getElementById("btn-preview")).removeAttribute("hidden"),s.href=`${API}/repair/preview/${e}/1.jpg`;const t=document.getElementById("fancybox-popup-form");for(let s=1;s<=resp.PrerviewCount;s++){var n=document.createElement("a");n.classList.add("fancybox"),n.setAttribute("rel","group"),n.setAttribute("data-fancybox","images"),n.href=`${API}/repair/preview/${e}/${s-1}.jpg`;var r=document.createElement("img");r.src=`${API}/repair/preview/thmb/${e}/${s-1}.jpg`,n.appendChild(r),t.appendChild(n)}document.getElementById("btn-preview").addEventListener("click",(()=>{"undefined"!=typeof gtag&&gtag("event","click_preview_button"),document.getElementsByClassName("fancybox")[0].click()}),!1)}else{var s;if(previewJson=JSON.parse(resp.PreviewJson),debug,(s=document.getElementById("btn-json-preview")).removeAttribute("hidden"),void 0!==previewJson.Tables){var o=document.getElementById("v-pills-tab");leftPanelInnerHTML="";for(const e in previewJson.Tables)if(Object.hasOwnProperty.call(previewJson.Tables,e)){previewJson.Tables[e];var a=Object.keys(previewJson.Tables).indexOf(e);leftPanelInnerHTML+=`<a class="nav-link ${0==a?"active":""}" id="v-pills-table-${a}-tab" data-bs-toggle="pill" href="#table-${a}" role="tab" aria-controls="v-pills-table-${a}" aria-selected="true">${e}</a>`}o.innerHTML=leftPanelInnerHTML;var i=document.getElementById("v-pills-tabContent"),d=[],l=0;for(const e in previewJson.Tables)if(Object.hasOwnProperty.call(previewJson.Tables,e)){const t=previewJson.Tables[e];const n=`<div class="tab-pane fade ${0==(a=Object.keys(previewJson.Tables).indexOf(e))?"show active":""}" id="table-${a}" role="tabpanel" aria-labelledby="v-pills-table-${a}-tab"><div class="table-responsive py-2"><table class="table-preview">`;let r="<thead><tr>";const s="</table></div></div>";t instanceof Array&&t.forEach(((e,t)=>{let n="";if(e instanceof Array)0==t?(n='<th scope="col">&nbsp;</th>',e.forEach((e=>{n+=`<th scope="col">${e}</th>`})),n+='<th scope="col">&nbsp;</th></tr></thead><tbody>',l=e.length):(n='<th scope="row">&nbsp;</th>',e.forEach((e=>{n+=`<td>${e}</td>`})),n+='<th scope="row">&nbsp;</th></tr>'),r+=n;else if("string"==typeof e){var s=e.trim().split(" ");s.length>0&&Number.parseInt(s[0])&&(n=`<tr><th scope="row">&nbsp;</th><td class="text-center" colspan="${l}"><strong><span class="color-light-green-dark fs-1">${s[0]}</span> rows more...</strong></td><th scope="row">&nbsp;</th></tr>`),r+=n}})),d.push(n+r+s)}i.innerHTML=d.join("")}document.getElementById("btn-preview").addEventListener("click",(()=>{"undefined"!=typeof gtag&&gtag("event","click_preview_button"),document.getElementsByClassName("fancybox")[0].click()}),!1)}resp.Paid&&document.getElementById("rt-next-button").addEventListener("click",(()=>{"undefined"!=typeof gtag&&gtag("event","click_next_button_to_download_page"),window.location=`${nextBasePage}/download.html?id=${e}`}),!1)}},t.onload=function(){4!=t.readyState||200==t.status||secondTry||(secondTry=!0,setTimeout((()=>{getResultInfo(e)}),1e3))},t.send()},getPreviewInfo=e=>{debug;var t=new XMLHttpRequest;t.open("GET",`${API}/api/repair/files/${e}/preview`,!0),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&t.response&&(resp=JSON.parse(t.response),debug,resp)},t.send()},getResultInfoByOrderId=e=>{debug;var t=new XMLHttpRequest;t.open("GET",`${API}/api/payments/getcid/${e}`,!0),t.onreadystatechange=function(){4==t.readyState&&200==t.status&&t.response&&(resp=JSON.parse(t.response),debug,resp&&resp.success&&getResultInfo(resp.downloadId))},t.send()};var $_GET=getParams();if($_GET&&$_GET.order_id)debug,getResultInfoByOrderId($_GET.order_id);else if($_GET&&$_GET.id)sessionStorage.setItem("recoverytoolbox.lastid",$_GET.id),getResultInfo($_GET.id),getPreviewInfo($_GET.id);else{const e=sessionStorage.getItem("recoverytoolbox.lastid");e&&($_GET.id=e,getResultInfo(e),getPreviewInfo(e))}